<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html" />
<link rel="import" href="../iron-icons/image-icons.html" />
<link rel="import" href="../iron-icons/av-icons.html" />
<link rel="import" href="../t-button/t-button.html" />
<link rel="import" href="../t-dropdown/t-dropdown.html" />
<dom-module id="t-pagination">
    <link rel="import" type="css" href="t-pagination.css" />
    <template>
        <style include="iron-flex"></style>
        <div class="pagination" hidden$="{{noPagination}}">        	
            <span style="float:right;">             
							<ul>
								<li id="prev" >
									<t-button only-icon class="min"  ico="image:navigate-before"  on-click="_onPrevPageClick"></t-button >
								</li>

								<li id="next">
									<t-button only-icon class="min"  ico="image:navigate-next" on-click="_onNextPageClick" ></t-button>
								</li>
							</ul>
						</span>
						<span style="float:right;">[[_currentPageStart]]-[[_currentPageEnd]] of [[totalRecords]]</span>
                        <span style="float:right;">Rows per page<t-dropdown label="Page Size"  dropdown-array='["10", "20", "30"]' selected-item="{{pageSize}}">
          </t-dropdown></span>
        </div>
    </template>
</dom-module>
<script>
Polymer({

    is: 't-pagination',

    properties: {

    		

        /**
         * The current page number
         */
        pageNumber: {
            type: Number,
            value: 1,
            notify: true,
            observer: '_pageNumberChanged',
            reflectToAttribute: true
        },

        /**
         * Atrribute to bind for the size of the page
         *
         * @type Number
         * @default 10
         */
        pageSize: {
            type: Number,
            value: 10,
            notify: true,
            observer: '_pageSizeChanged',
            reflectToAttribute: true
        },

        totalRecords: {
            type: Number,
            value: 0,
            notify: true,
            reflectToAttribute: true,
            //observer: '_checkPageSizeList',
        },

        // pageSizeList: {
        //     type: Array,
        //     value: function(){
        //         return ["10", "20", "30"];
        //     },
        //     notify: true,
        //     observer: '_checkPageSizeList',
        // },

        _currentPageStart: {
            type: Number,
            computed: '_calculateCurrentPageStart(pageNumber, pageSize)'
        },

        _currentPageEnd: {
            type: Number,
            computed: '_calculateCurrentPageEnd(pageNumber, pageSize, totalRecords)'
        },


    },

    attached: function() {
        if (this.totalRecords) {
            this._handleExtremities();
        }
    },


    _handleExtremities: function() {
         this.$.next.disabled = true;
        this.$.prev.disabled = true;

        if (this.pageNumber == 1) {
            if (Math.ceil(this.totalRecords / this.pageSize) > 1){
                this.$.next.disabled = false;
            }
            this.$.prev.disabled = true;
        } else if (this.pageNumber == Math.ceil(this.totalRecords / this.pageSize)) {
            this.$.next.disabled = true;
            this.$.prev.disabled = false;
        } else {
            this.$.next.disabled = false;
            this.$.prev.disabled = false;
        }
    },

    _pageNumberChanged: function() {
        this._handleExtremities();
    },

    _pageSizeChanged: function(e) {
        if(e){
            //reset page to 1 when ever page size changes
            this.pageNumber = 1;
            //update prev/next handles
            this._handleExtremities();
            //raise event
            this.fire('t-paginated', this._getTableData());
        }
    },

    _checkPageSizeList:function() {
        if(this.totalRecords && this.pageSizeList && this.pageSizeList.count){
            //TODO: Add logic to programatically update page size list as per total records
        }
    },


    _calculateCurrentPageStart: function(pageNumber, pageSize) {
        return ((pageNumber - 1) * pageSize) + 1;
    },

    _calculateCurrentPageEnd: function(pageNumber, pageSize, totalRecords) {
        if (Math.ceil(this.totalRecords / this.pageSize) == pageNumber) {
            return this.totalRecords;
        } else {

            return pageNumber * pageSize;
        }
    },


    /**
     * Function to call the table data 
     */
    _getTableData: function() {
        var data = {
            pageSize: this.pageSize,
            pageNumber: this.pageNumber
        };
        return data;
    },

    /**
     * Function to call the NextPage data
     */
    _onNextPageClick: function() {
        if (this.$.next.disabled)
            return;

        this.pageNumber++;
        this.fire('t-paginated', this._getTableData());
    },

    /**
     * Function to call the PrevPage data
     */
    _onPrevPageClick: function() {
        if (this.$.prev.disabled)
            return;

        this.pageNumber--;
        this.fire('t-paginated', this._getTableData());
    },

    /**
     * Check the count if +1
     */
    noPagination: function() {
        return this.totalRecords == 0;
    }
});
</script>
