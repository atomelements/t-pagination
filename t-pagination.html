<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html" />

<link rel="import" href="../t-button/t-button.html" />
<link rel="import" href="../t-dropdown/t-dropdown.html" />
<dom-module id="t-pagination">
    <template>
        <style include="iron-flex">
        :host{
            display: block;
            font-family: var(--primary-font-family,'Open sans');
            font-size: var(--pagination-font-size,14px);
            /*width: var(--pagination-width,360px);*/
        }
        t-dropdown{    
            width: 50px;
            min-width: 50px;
            margin: 0 5px;
        }
        .pagination > *{
          -ms-flex-align: end;
          -webkit-align-items: flex-end;
          align-items: flex-end;
        }
        </style>
        <div class="pagination layout horizontal center" hidden$="{{noPagination}}">
            <span>Rows per page: </span>
            <t-dropdown label=" "  no-label-float dropdown-array='["10","20","30"]' selected-item="{{pageSize}}">
            </t-dropdown>
            <span>[[_currentPageStart]]-[[_currentPageEnd]] of [[totalRecords]]</span>
            <t-button id="prev" only-icon class="min"  ico="chevron-left"  on-click="_onPrevPageClick"></t-button >

            <t-button id="next" only-icon class="min"  ico="chevron-right" on-click="_onNextPageClick" ></t-button>
                    
        </div>
    </template>
</dom-module>
<script>
Polymer({

    is: 't-pagination',

    properties: {



        /**
         * The current page number
         */
        pageNumber: {
            type: Number,
            value: 1,
            notify: true,
            observer: '_pageNumberChanged',
            reflectToAttribute: true
        },

        /**
         * Atrribute to bind for the size of the page
         *
         * @type Number
         * @default 10
         */
        pageSize: {
            type: Number,
            value: 10,
            notify: true,
            observer: '_pageSizeChanged',
            reflectToAttribute: true
        },

        totalRecords: {
            type: Number,
            value: 0,
            notify: true,
            reflectToAttribute: true,
            //observer: '_checkPageSizeList',
        },

        // pageSizeList: {
        //     type: Array,
        //     value: function(){
        //         return ["10", "20", "30"];
        //     },
        //     notify: true,
        //     observer: '_checkPageSizeList',
        // },

        _currentPageStart: {
            type: Number,
            computed: '_calculateCurrentPageStart(pageNumber, pageSize)'
        },

        _currentPageEnd: {
            type: Number,
            computed: '_calculateCurrentPageEnd(pageNumber, pageSize, totalRecords)'
        },


    },

    attached: function() {
        if (this.totalRecords) {
            this._handleExtremities();
        }
    },
    _handleExtremities: function() {
        this.$.next.disabled = true;
        this.$.prev.disabled = true;

        if (this.pageNumber == 1) {
            if (Math.ceil(this.totalRecords / this.pageSize) > 1) {
                this.$.next.disabled = false;
            }
            this.$.prev.disabled = true;
        } else if (this.pageNumber == Math.ceil(this.totalRecords / this.pageSize)) {
            this.$.next.disabled = true;
            this.$.prev.disabled = false;
        } else {
            this.$.next.disabled = false;
            this.$.prev.disabled = false;
        }
    },

    _pageNumberChanged: function() {
        this._handleExtremities();
    },

    _pageSizeChanged: function(e) {
        if (e) {
            //reset page to 1 when ever page size changes
            this.pageNumber = 1;
            //update prev/next handles
            this._handleExtremities();
            //raise event
            this.fire('t-paginated', this._getTableData());
        }
    },

    _checkPageSizeList: function() {
        if (this.totalRecords && this.pageSizeList && this.pageSizeList.count) {
            //TODO: Add logic to programatically update page size list as per total records
        }
    },


    _calculateCurrentPageStart: function(pageNumber, pageSize) {
        return ((pageNumber - 1) * pageSize) + 1;
    },

    _calculateCurrentPageEnd: function(pageNumber, pageSize, totalRecords) {
        if (Math.ceil(this.totalRecords / this.pageSize) == pageNumber) {
            return this.totalRecords;
        } else {

            return pageNumber * pageSize;
        }
    },


    /**
     * Function to call the table data 
     */
    _getTableData: function() {
        var data = {
            pageSize: this.pageSize,
            pageNumber: this.pageNumber
        };
        return data;
    },

    /**
     * Function to call the NextPage data
     */
    _onNextPageClick: function() {
        if (this.$.next.disabled)
            return;

        this.pageNumber++;
        this.fire('t-paginated', this._getTableData());
    },

    /**
     * Function to call the PrevPage data
     */
    _onPrevPageClick: function() {
        if (this.$.prev.disabled)
            return;

        this.pageNumber--;
        this.fire('t-paginated', this._getTableData());
    },

    /**
     * Check the count if +1
     */
    noPagination: function() {
        return this.totalRecords == 0;
    }
});
</script>
